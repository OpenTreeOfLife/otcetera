\documentclass[11pt]{article}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage[authoryear,round]{natbib}
\bibliographystyle{plainnat}
\usepackage{bm}
\usepackage{color}
\usepackage{graphicx}
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{definition}{Definition}
\usepackage{xspace}
\usepackage{paralist}
\usepackage{setspace}
\textwidth 6.5in
\hoffset -1in
\singlespacing

% Abbreviations
\newcommand{\otol}{Open Tree of Life\xspace}
\newcommand{\ps}{phylogenetic statement\xspace}
\newcommand{\pss}{phylogenetic statements\xspace}
\newcommand{\PSs}{Phylogenetic Statements\xspace}
\newcommand{\PS}{Phylogenetic Statement\xspace}

% Notation
\newcommand{\leafLabels}[1]{\ensuremath{\mathcal{L}(#1)}}
\newcommand{\parent}[1]{\ensuremath{\mbox{par}(#1)}}
\newcommand{\children}[1]{\ensuremath{\mbox{children}(#1)}}
\newcommand{\taxonomy}[0]{\ensuremath{\mathbb{T}}}
% verbatim, verbatim notation for a \ps
\newcommand{\vvps}[2]{\ensuremath{{#1}\downarrow{#2}}}
% leaf set, verbatim notation for a \ps
\newcommand{\lvps}[2]{\ensuremath{\leafLabels{#1}\uparrow{#2}}}
\newcommand{\leafComp}[2]{\ensuremath{\widetilde{\mathcal{L}_{#2}}\left({#1}\right)}}
\newcommand{\displaysPred}[2]{\ensuremath{\mathbb{I}_d(#1, #2)}}

\DeclareMathOperator*{\argmax}{\arg\!\max}

\usepackage{hyperref}
\hypersetup{backref,  linkcolor=blue, citecolor=black, colorlinks=true, hyperindex=true}
\begin{document}
The source for this in the doc subdirectory of the otcetera
    repo \url{https://github.com/OpenTreeOfLife/otcetera/tree/doc/doc}.
\begin{center}
    {\bf Summarizing a taxonomy and multiple estimates of phylogenetic trees} \\
{Mark T.~Holder$^{1,2,\ast}$. feel free to contribute and add your name}
\end{center}
\section{Background}
The \otol project is attempting to build a platform for summarizing what is known
    about phylogenetic relationships across all of Life.
Presenting an easy-to-interpret summary of trees that have been ``curated''
    is one component of that effort.
The project has decided that this summary should include a tree which
\begin{compactenum}
    \item can be served and browsed;
    \item contains annotations indicating which input trees support a particular grouping;
    \item has all of the tips of the taxonomy;
    \item displays as many of the groups in the input trees as is feasible;
    \item may utilize ranking of trees;
    \item (tentative - not sure if everyone is on board with this one) has no unsupported groups;\label{noUnsupportedReq}
    \item (tentative) does not ``prefer'' lack of resolution (defined more thoroughly below)
\end{compactenum}
This is results in a new form of a supertree problem described below as the ``taxonomy-based tree summary'' problem.
\subsection{Taxonomy-based supertree}
This is a novel name for a special form of the supertree problem.
A taxonomy-base supertree has at least one input (the taxonomic tree) is complete.
\subsection{Taxonomy-based summary tree}
Many supertree approaches seek to maximize accuracy according to some notion
    of distance between the true tree and estimated true.
The summary that we seek has requirements (e.g. \ref{noUnsupportedReq})
    which lead to less resolved trees.
Such trees may fail to display all of the well-supported (or even uncontested)
    rooted triples, but such trees also make it easier for users to see the
    connection between the summary tree and the input trees.
Thus, the phrase ``Taxonomy-based summary tree'' is used here to describe a
    taxonomy-based supertree which tries to maximize some notion of
    explaining the set of input trees (rather than a supertree designed to
    display the highest number of groups in the inputs, or some other criterion).

\subsection{Taxonomy-based summary of ranked input trees}
We have been pursuing a strategy that uses a ranking of trees.
In cases of conflict, the grouping that is compatible with the 
    higher ranked tree is shown in the tree (if it is not contradicted by 
    another grouping from trees of even higher rank).
 The taxonomic tree is considered to be the lowest ranked input.

Applying a ranking to the input trees is biologically questionable (because
    the importance of an input \ps should be based on the support for that
    grouping -- it is rarely the case that tree-wide rank would adequately
    describe the degree of statistical support for that group).
Using tree-based ranks also introduces subjectivity into the summary buildind process.

Nevertheless, tree-rank based summaries represent a reasonable starting point
    because they are easy to explain and the ranking permits some algorithmic
    simplifications.

\section{More Background}
\subsection{The Sum of Weighted Input \PSs Displayed Score}
Let $\mathcal{P}$ be a multiset of \pss.
If each member, $i$, this set is assigned a weight, $w_i$, then the 
sum of weighted input \pss displayed score, $S_w$, for a tree $T$ is:
\begin{equation}
    S_w(T, \mathcal{P}) = \sum_{i\in \mathcal{P}} w_i \displaysPred{T}{i}
\end{equation}
where {\displaysPred{T}{x}} is an identity function that evaluates to 1 if tree $T$
        displays $x$, and to 0 otherwise.

Trying to find the set of trees that maximize $S_w$ is one natural
    goal for a summarization procedure.
We can call this the ``maximum sum of weighted input \pss displayed'' problem,
    and the set of trees that maximize the score are denoted:
\begin{equation}
    \mathcal{S}_{w}(\mathcal{P}) = \argmax_T S_w(T,\mathcal{P}) 
\end{equation}

Tree-based ranking can be viewed as a means providing weights to \pss.
Each tree is converted to a set of \pss, and the tree's weight is 
    assigned to each \ps in the set.
The union of the tree's sets becomes the multiset, $\mathcal{P}$, referred to
    in the definition of the score above.

\href{https://github.com/OpenTreeOfLife/treemachine/wiki/MaxWeightOfInputTreeEdgesDisplayed}{This link}
    sketches out a proof of how an extreme form of tree-based ranks
    can lead to greedy tree addition strategy can be guaranteed to 
    find the set of trees that solve the maximimum sum of weighted input
    \pss displayed problem.
If the difference in tree ranks are sufficiently large from one tree to the next,
    then there is no need to consider skipping a \ps from a high ranking tree
    even if not considering that grouping would result in all of the \ps
    from the lower ranking trees being displayed.

Unfortunately, that proof only applies to an exact algorithm which returns
    all possible trees that maximize the score.
We do not know of a polynomial-time algorithm for solving that problem.

\subsection{Trees without unsupported groups}
Consider an edge connecting parent $\parent{V}$ to it child $V$ in a complete tree $T$.
This edge is supported (or ``the node $V$ is supported'') in the sense of the maximum sum of 
    weighted input \pss displayed score if
    collapsing the edge leads to a lower (worse) score.
For an edge to be supported in this sense, it must display in input \pss, and
    the tree that woudld be created by collapsing the edge to a polytomy must
    {\em not} display the \pss.

Equivalently, we can state the conditions node $V$ (or it subtending) begin supported
    by an input \pss derived from node $x$ of tree $t$ as:
\begin{eqnarray}
    \leafLabels{V} \cap \leafLabels{t} & = & \leafLabels{x}\\
    \left(\leafLabels{\parent{V}} \cap \leafLabels{t}\right) - \leafLabels{x} & \neq &\emptyset\\
    \leafLabels{c} \cap \leafLabels{t} & \neq & \leafLabels{x} \hskip 2em \forall c \in \children{V}
\end{eqnarray}
where $\children{V}$ is the set of nodes that are children of $V$.
The first condition guarantees that the node $V$ displays the \ps made by $x$.
The second condition assures that if the edge leading to $V$ were collapsed, the resulting polytomy would not display the \ps.
The final condition assures that none of the children of $V$ also display this \ps from $x$;
    if any child displayed the \ps, then collapsing the edge leading to $V$ would still
    yield a tree that still displays the \ps derived from $x$.

If we demand that a summary tree contains no unsupported groups (in the previous sense of support), we 
    are constraining the set of summary trees such that, for every internal node in the summary tree
    there is at least one \pss in the input set that supports it.
This is indeed restrictive, as the sum of the number of internal nodes in the inputs becomes an upper bound
    on the number of internal nodes in the summary tree.
However, restricting the summary to only contain supported groups does not decrease the 
    number of \pss from the inputs that are displayed.
If $\mathcal{S}_s$ is the subset of $\mathcal{S}_w$ which do not contain any unsupported nodes,
    then $\mathcat{S}_s$ is never empty, but may be much smaller than $\mathcal{S}_w$ because
    every resolution of $\mathcal{S}_s$ is a member of $\mathcal{S}_w$.
\input{glossary.tex}

\bibliography{otcetera}
\end{document}
